<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<chapter version="5.1" xml:id="cha.admin.misc"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink">
 <info>
  <title>Miscellaneous Configuration</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <sect1 xml:id="sec.admin.misc.timezone">
  <title>Configuring Timezone</title>
  <para>
   To configure the timezone during deployment you can use
   <command>cloud-init</command> or <command>&ay;</command> during the initial
   installation procedure. If you wish to change the timezone for an existing
   cluster, you must update it manually using <command>Salt</command>.
  </para>
  <sect2>
   <title>New Deployment</title>
   <sect3>
    <title>Using cloud-init</title>
    <para>
     <xref linkend="sec.deploy.cloud-init.user-data.timezone" />
    </para>
   </sect3>
   <sect3>
    <title>Using &ay;</title>
    <para>
     Use a modified &ay; control file as described in
     <xref linkend="sec.deploy.autoyast" />.
    </para>
   </sect3>
  </sect2>

  <sect2>
   <title>Existing Deployment</title>
   <para>
    To change the timezone on an existing cluster you must use
    <command>Salt</command> to remove the <filename>/etc/localtime</filename>
    symlink and replace it with the desired timezone file from <filename>/usr/share/zoneinfo</filename>
    in its place. SSH into the Admin node and run:
   </para>
<screen>
&prompt.user;<command>docker exec -it $(docker ps -q -f name="salt-master") \
salt -P 'roles:(admin|kube-(master|minion)' \
cmd.run "ln -sf <replaceable>/usr/share/zoneinfo/Europe/Berlin</replaceable> /etc/localtime"</command>
   </screen>
  </sect2>
 </sect1>

 <sect1 xml:id="sec.admin.misc.issue-generator">
  <title>The <command>issue-generator</command> Command</title>
  <para>
   On &suse; &mos;, <filename>/etc/issue</filename> is generated by
   <command>issue-generator</command>.
  </para>
  <para>
   This allows &mos; to display a dynamic message above the login prompt,
   which is generated from the contents of several different files.
  </para>
  <para>
   Files in <filename>/etc/issue.d</filename> override files with the same
   name in <filename>/usr/lib/issue.d</filename> and
   <filename>/run/issue.d</filename>. Files in
   <filename>/run/issue.d</filename> override files with the same name in
   <filename>/usr/lib/issue.d</filename>.
  </para>
  <para>
   Packages should install their configuration files in
   <filename>/usr/lib/issue.d</filename>. Files in
   <filename>/etc/issue.d</filename> are reserved for the local administrator,
   who may use this logic to override the files installed by vendor packages.
  </para>
  <para>
   All configuration files are sorted by their filename in lexicographic
   order, regardless of which of the directories they reside in.
  </para>
  <para>
   If you run the command without any arguments, all the input files will be
   applied.
  </para>
  <para>
   Which network interfaces are shown can be configured in the file
   <filename>/etc/sysconfig/issue-generator</filename>.
  </para>
  <para>
   To disable the display of ssh keys, use the following command:
  </para>
 <screen>
&prompt.root;<command>systemctl disable issue-add-ssh-keys.service</command>
   </screen>
 </sect1>
 
 <sect1 xml:id="sec.admin.misc.flexvolume">
  <title>FlexVolume configuration</title> 
  <para>
   FlexVolume drivers are external (out-of-tree) drivers usually provided by
   a specific vendor. They are executable files, which are placed in a 
   predefined directory in the cluster on both worker and master nodes. 
   Pods interact with FlexVolume drivers through the <command>flexvolume</command>
   in-tree plugin.
  </para>
  <para>
   The vendor driver first has to be installed on each worker and master node
   in a Kubernetes cluster. On &productname; &productnumber; the path to install 
   the drivers is <filename>/usr/libexec/kubernetes/kubelet-plugins/volume/exec/</filename>.
  </para>
  <para>
   If the drivers are deployed with DaemonSet, this will require changing 
   the flexvolume directory path, which is usually stored as an environment 
   variable, e.g. for rook:
  </para>
  <screen>
<varname>FLEXVOLUME_DIR_PATH=/usr/libexec/kubernetes/kubelet-plugins/volume/exec/</varname>
  </screen>
  <para>
   For more information on DaemonSets, refer to <xref linkend="cha.user.daemonset"/> 
  </para>
  <para>
   For a general guide to the FlexVolume configuration, see 
   <link xlink:href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-storage/flexvolume.md" />
  </para>
 </sect1>
 
</chapter>
