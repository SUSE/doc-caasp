<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<chapter version="5.0" xml:id="cha.deploy.requirements"
 xmlns="http://docbook.org/ns/docbook"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink">
 <info>
  <title>System Requirements</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  This chapter specifies the requirements to install and operate
  &productname;. Before you begin the installation, please make sure
  your system meets all requirements listed below.
 </para>
 <sect1 xml:id="sec.deploy.requirements.system.cluster">
  <title>Cluster Size Requirements</title>
  <para>
   &productname; is a dedicated cluster operating system and only functions in a
   multi-node configuration. It requires a connected group of four or more
   physical or virtual machines.
  </para>
  <para>
   The minimum supported cluster size is four nodes: a single &admin_node;, one
   &master_node;, and two &worker_node;s.
  </para>
  <note>
   <title>Test and Proof-of-Concept Clusters</title>
   <para>
    It is possible to provision a three-node cluster with only a single
    &worker_node;, but this is not a supported configuration for deployment.
   </para>
  </note>
  <para>
   For improved performance, multiple &master_node;s are supported, but there
   must always be an odd number. For cluster reliability, when using multiple
   master nodes, some form of DNS load-balancing should be used.
  </para>
  <para>Any number of &worker_node;s may be added up to the maximum cluster
   size. For the current maximum supported number of nodes, please refer to
   the Release Notes on <link xlink:href="https://www.suse.com/releasenotes/"/>.
  </para>
 </sect1>

 <sect1 xml:id="sec.deploy.requirements.environment">
  <title>Supported Environments</title>
  <para>
   Regarding deployment scenarios, &suse; supports &productname; running in
   the following environments:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     &productname; only supports x86_64 hardware.
    </para>
   </listitem>
   <listitem>
    <para>
     Aside from this, the same hardware and virtualization platforms
     as &sle; 12 SP3 are supported. For a list of certified hardware,
     see <link xlink:href="https://www.suse.com/yessearch/" />.
    </para>
   </listitem>
   <listitem>
    <para>
     Virtualized&mdash;running under the following hypervisors:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       KVM
      </para>
      <itemizedlist>
       <listitem>
        <para>
         on &sle; 11 SP4
        </para>
       </listitem>
       <listitem>
        <para>
         on &sle; 12 SP1
        </para>
       </listitem>
       <listitem>
        <para>
         on &sle; 12 SP2
        </para>
       </listitem>
       <listitem>
        <para>
         on &sle; 12 SP3
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
     <listitem>
      <para>
       Xen
      </para>
      <itemizedlist>
       <listitem>
        <para>
         same host platforms as for KVM
        </para>
       </listitem>
       <listitem>
        <para>
         full virtualization
        </para>
       </listitem>
       <listitem>
        <para>
         paravirtualization
        </para>
       </listitem>
       <listitem>
        <para>
         Citrix XenServer 6.5
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
     <listitem>
      <para>
       VMware
      </para>
      <itemizedlist>
       <listitem>
        <para>
         ESX 5.5
        </para>
       </listitem>
       <listitem>
        <para>
         ESXi 6.0
        </para>
       </listitem>
       <listitem>
        <para>
         ESXi 6.5+
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
     <listitem>
      <para>
       Hyper-V
      </para>
      <itemizedlist>
       <listitem>
        <para>
         Windows Server 2008 SP2+
        </para>
       </listitem>
       <listitem>
        <para>
         Windows Server 2008 R2 SP1+
        </para>
       </listitem>
       <listitem>
        <para>
         Windows Server 2012+
        </para>
       </listitem>
       <listitem>
        <para>
         Windows Server 2012 R2+
        </para>
       </listitem>
       <listitem>
        <para>
         Windows Server 2016
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
     <listitem>
      <para>
       Oracle VM 3.3
      </para>
     </listitem>
    </itemizedlist>
    <important>
     <title>&vmware; Memory Ballooning</title>
     <para>
      If installing &productname; on &vmware; you must disable &vmware;'s
      memory ballooning feature. VMware has instructions on how to do this
      here: <link xlink:href="https://kb.vmware.com/s/article/1002586"></link>
     </para>
    </important>
   </listitem>
   <listitem>
    <para>
     Private and Public Cloud Environments
    </para>
    <itemizedlist>
     <listitem>
      <para>
       &soc; 7
      </para>
     </listitem>
     <listitem>
      <para>
       Amazon AWS
      </para>
     </listitem>
     <listitem>
      <para>
       Microsoft Azure
      </para>
     </listitem>
     <listitem>
      <para>
       Google Compute Engine
      </para>
     </listitem>
    </itemizedlist>
   </listitem>
  </itemizedlist>
 </sect1>

 <sect1 xml:id="sec.deploy.requirements.storage">
  <title>Container Data Storage</title>
  <para>
   Storage can be provided using:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     &ses;
    </para>
   </listitem>
   <listitem>
    <para>
     NFS
    </para>
   </listitem>
   <listitem>
    <para>
     <command>hostpath</command>
    </para>
    <note>
     <title><literal>hostpath</literal> Storage</title>
     <para>
      Storage using <literal>hostpath</literal> is still supported, but by
      default it is disabled by <literal>PodSecurityPolicies</literal>.
     </para>
    </note>
   </listitem>
  </itemizedlist>
 </sect1>

 <sect1 xml:id="sec.deploy.requirements.hardware">
  <title>Minimum Node Specification</title>
  <para>
   Each node in the cluster must meet the following minimum specifications.
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     Any AMD64/Intel* EM64T processor (quad-core processors are recommended).
     32-bit processors are not supported.
    </para>
   </listitem>
   <listitem>
    <para>
     Minimum RAM: 8 GB.
    </para>
   </listitem>
   <listitem>
    <para>
     Minimum disk space: 40 GB for the root file system with Btrfs and
     enabled snapshots.
    </para>
    <para>
     Additional disk space may be required, depending on the count and size of
     container images you intend to run.
    </para>
   </listitem>
  </itemizedlist>
  <note>
   <title>Swap partitions</title>
   <para>
    &kube; does not support swap. For technical reasons, an &admin_node;
    installed from an ISO image will have a small swap partition which will be
    disabled after installation. Nodes built using &ay; have none. Although it
    may be possible to install &productname; with less memory, there is a
    high risk that the operating systems runs out of memory and subsequently
    causes a cluster failure.
   </para>
  </note>
 </sect1>

 <sect1 xml:id="sec.deploy.requirements.network">
  <title>Network Requirements</title>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     All the nodes on the cluster must be on a the same network and be able to
     communicate directly with one another.
    </para>
    <important>
     <title>Reliable Networking</title>
     <para>
      Please make sure all nodes can communicate without interruptions.
     </para>
    </important>
   </listitem>
   <listitem>
    <para>
     The admin node and the &kube; API master must have valid Fully-Qualified
     Domain Names (FQDNs), which can be resolved both by all other nodes and
     from other networks which need to access the cluster.
    </para>
    <para>
     Admin node and &kube; API master node should be configured as CNAME records
     in the local DNS. This improves portability for disaster recovery.
    </para>
   </listitem>
   <listitem>
    <para>
     A DHCP server to dynamically provide IP addresses and host names for the
     nodes in your cluster (unless you configure all nodes statically).
    </para>
   </listitem>
   <listitem>
    <para>
     A DNS server to resolve host names. If you are using host names to
     specify nodes, please make sure you have reliable DNS resolution at all
     times, especially in combination with DHCP.
    </para>
    <important>
     <title>Unique Host Names</title>
     <para>
      Host names must be unique. It is recommended to let the DHCP server
      provide not only IP addresses but also host names of the cluster nodes.
     </para>
    </important>
   </listitem>
   <listitem>
    <para>
     On the same network, a separate computer with a Web browser is required
     in order to complete bootstrap of the cluster.
    </para>
   </listitem>
   <listitem>
    <para>
     In a &productname; cluster, internal TCP/IP ports are managed using
     <literal>iptables</literal> controlled by <literal>Salt</literal> and so
     need not be manually configured. However, for reference and for
     environments where there are existing security policies, the following
     are the standard ports in use.
    </para>
    <table xml:id="tab.deploy.requirements.ports">
     <title>Node types and open ports</title>
     <tgroup cols="6">
      <thead>
       <row>
        <entry>
         <para>
          Node
         </para>
        </entry>
        <entry>
         <para>
          Port
         </para>
        </entry>
        <entry>
         <para>
          Internal / External
         </para>
        </entry>
        <entry>
         <para>
          Open after orchestration
         </para>
        </entry>
        <entry>
         <para>
          Description
         </para>
        </entry>
        <entry>
         <para>
          Notes
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          All nodes
         </para>
        </entry>
        <entry>
         <para>
          22
         </para>
        </entry>
        <entry>
         <para>
          Internal
         </para>
        </entry>
        <entry>
         <para>
          No
         </para>
        </entry>
        <entry>
         <para>
          ssh
         </para>
        </entry>
        <entry>
         <para>
          Useful but not essential
         </para>
        </entry>
       </row>
       <row>
        <entry morerows="4" valign="middle">
         <para>
          Admin
         </para>
        </entry>
        <entry>
         <para>
          80
         </para>
        </entry>
        <entry>
         <para>
          External
         </para>
        </entry>
        <entry>
         <para>
          No
         </para>
        </entry>
        <entry>
         <para>
          HTTP
         </para>
        </entry>
        <entry/>
       </row>
       <row>
        <entry>
         <para>
          389
         </para>
        </entry>
        <entry>
         <para>
          External
         </para>
        </entry>
        <entry>
         <para>
          No
         </para>
        </entry>
        <entry>
         <para>
          LDAP
         </para>
        </entry>
        <entry>
         <para>
          User management
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          443
         </para>
        </entry>
        <entry>
         <para>
          External
         </para>
        </entry>
        <entry>
         <para>
          No
         </para>
        </entry>
        <entry>
         <para>
          HTTPS
         </para>
        </entry>
        <entry/>
       </row>
       <row>
        <entry>
         <para>
          2379
         </para>
        </entry>
        <entry>
         <para>
          Internal
         </para>
        </entry>
        <entry>
         <para>
          No
         </para>
        </entry>
        <entry>
         <para>
          <literal>etcd</literal> discovery
         </para>
        </entry>
        <entry/>
       </row>
       <row>
        <entry>
         <para>
          4505 - 4506
         </para>
        </entry>
        <entry>
         <para>
          Internal
         </para>
        </entry>
        <entry>
         <para>
          No
         </para>
        </entry>
        <entry>
         <para>
          Salt
         </para>
        </entry>
        <entry/>
       </row>
       <row>
        <entry morerows="3" valign="middle">
         <para>
          Masters
         </para>
        </entry>
        <entry>
         <para>
          2380
         </para>
        </entry>
        <entry>
         <para>
          Internal
         </para>
        </entry>
        <entry>
         <para>
          Yes
         </para>
        </entry>
        <entry>
         <para>
          <literal>etcd</literal> control
         </para>
        </entry>
        <entry>
         <para>
          Peer-to-peer <literal>etcd</literal> traffic
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          4789
         </para>
        </entry>
        <entry>
         <para>
          Internal
         </para>
        </entry>
        <entry>
         <para>
          No
         </para>
        </entry>
        <entry>
         <para>
          VXLAN traffic
         </para>
        </entry>
        <entry>
         <para>
          Used by Flannel
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          6443
         </para>
        </entry>
        <entry>
         <para>
          Both
         </para>
        </entry>
        <entry>
         <para>
          Yes
         </para>
        </entry>
        <entry>
         <para>
          &kube; API server
         </para>
        </entry>
        <entry/>
       </row>
       <row>
        <entry>
         <para>
          32000
         </para>
        </entry>
        <entry>
         <para>
          External
         </para>
        </entry>
        <entry>
         <para>
          Yes
         </para>
        </entry>
        <entry>
         <para>
          Dex
         </para>
        </entry>
        <entry>
         <para>
          OICD Connect
         </para>
        </entry>
       </row>
       <row>
        <entry morerows="3" valign="middle">
         <para>
          Workers
         </para>
        </entry>
        <entry>
         <para>
          2380
         </para>
        </entry>
        <entry>
         <para>
          Internal
         </para>
        </entry>
        <entry>
         <para>
          Yes
         </para>
        </entry>
        <entry>
         <para>
          <literal>etcd</literal> control
         </para>
        </entry>
        <entry>
         <para>
          Peer-to-peer <literal>etcd</literal> traffic
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          4789
         </para>
        </entry>
        <entry>
         <para>
          Internal
         </para>
        </entry>
        <entry>
         <para>
          No
         </para>
        </entry>
        <entry>
         <para>
          VXLAN traffic
         </para>
        </entry>
        <entry>
         <para>
          Used by Flannel
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          10250
         </para>
        </entry>
        <entry>
         <para>
          Internal
         </para>
        </entry>
        <entry>
         <para>
          No
         </para>
        </entry>
        <entry>
         <para>
          Kubelet
         </para>
        </entry>
        <entry/>
       </row>
       <row>
        <entry>
         <para>
          32000
         </para>
        </entry>
        <entry>
         <para>
          External
         </para>
        </entry>
        <entry>
         <para>
          Yes
         </para>
        </entry>
        <entry>
         <para>
          Dex
         </para>
        </entry>
        <entry>
         <para>
          OICD Connect
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </table>
   </listitem>
  </itemizedlist>
  <para>
   When some additional ingress mechanism is used, additional ports would also
   be open.
  </para>
 </sect1>

 <sect1 xml:id="sec.deploy.requirements.public_cloud">
  <title>General Public Cloud Requirements</title>
  <para>
   In Amazon EC2, the adminstrative instance must be launched with an IAM role
   that allows full access to the EC2 API. In Microsoft Azure, all security
   credentials will be collected during setup. In Google Compute Engine, the
   instance must be launched with an IAM role including <literal>Compute
   Admin</literal> and <literal>Service Account Actor</literal> scopes.
  </para>
  <para>
   Select an instance size for the Administrative node that meets the system
   requirements as documented in the &productname; documentation.
  </para>
  <variablelist>
   <varlistentry>
    <term>Memory</term>
    <listitem>
     <para>
      Minimal main memory: 8GB
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Volume Size</term>
    <listitem>
     <para>
      Root volume size should be at least 40GB and is dependent on the size and
      number of different containers running in the cluster. The default root
      volume size of the images is smaller than 40GB in some Public Cloud
      frameworks; you must resize the root volume to meet your needs upon
      instance launch using the command line tools or the web interface for the
      framework of your choice.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>

 <sect1 xml:id="sec.deploy.requirements.public_cloud_network">
  <title>Public Cloud Network Requirements</title>
  <para>
   &productname; expects that DNS resolution is functional. In general, Public
   Cloud providers provide a DNS service that works with internal host names.
   You can also set up your own DNS resolution; please refer to the
   documentation of the Public Cloud provider of your choice to configure your
   own DNS service.
  </para>
  <para>
   It is recommended that &productname; is setup to run in two subnets in one
   network segment, also referred to as VPC or VNET. The Administrative node
   should run in a subnet that is not accessible to the outside world and
   should be connected to your network via VPN or other means. Consider a
   security group/firewall that only allows ingress traffic on ports 22 (SSH)
   and 443 (https) for the Administrative node from outside the VPC. All nodes
   must have access to the Internet through some route in order to connect to
   SCC and receive updates, or be otherwise configured to receive updates (e.g.
   via an SMT server).
  </para>
  <para>
   Depending on the applications running in your cluster you may consider
   exposing the subnet for the cluster nodes to the outside world. Use a
   security group/firewall that only allows incoming traffic on ports served by
   your workload(s). For example, a containerized application providing the
   backend for REST based services with content served over https should only
   allow ingress traffic on port 443.
  </para>
  <para>
   Traffic between the two subnets should be allowed to flow freely.
   &productname; uses the following ports:
  </para>
  <para>
   <guimenu>Administrative node</guimenu>
  </para>
  <itemizedlist>
   <listitem>
    <para>
     ssh: 22
    </para>
   </listitem>
   <listitem>
    <para>
     http: 80 (Redirects to 443, https)
    </para>
   </listitem>
   <listitem>
    <para>
     ntp: 123 (In cases where the service provider has a time service the admin
     node image is configured to use the ntp service provided by the framework.
     Cluster nodes always point back to the admin node)
    </para>
   </listitem>
   <listitem>
    <para>
     slapd: 389
    </para>
   </listitem>
   <listitem>
    <para>
     https: 443
    </para>
   </listitem>
   <listitem>
    <para>
     etcd: 2379
    </para>
   </listitem>
   <listitem>
    <para>
     etcd: 2380
    </para>
   </listitem>
   <listitem>
    <para>
     salt master: 4505
    </para>
   </listitem>
   <listitem>
    <para>
     salt master: 4506
    </para>
   </listitem>
  </itemizedlist>
  <para>
   <guimenu>Master node role</guimenu>
  </para>
  <itemizedlist>
   <listitem>
    <para>
     ssh: 22
    </para>
   </listitem>
   <listitem>
    <para>
     etcd: 2379
    </para>
   </listitem>
   <listitem>
    <para>
     etcd: 2380
    </para>
   </listitem>
   <listitem>
    <para>
     kubelet: 4198
    </para>
   </listitem>
   <listitem>
    <para>
     haproxy: 6443
    </para>
   </listitem>
   <listitem>
    <para>
     haproxy: 6444
    </para>
   </listitem>
   <listitem>
    <para>
     flanneld: 8285 (UDP)
    </para>
   </listitem>
   <listitem>
    <para>
     kubelet: 10250
    </para>
   </listitem>
   <listitem>
    <para>
     kube-scheduler: 10251
    </para>
   </listitem>
   <listitem>
    <para>
     kube-controller-manager: 10252
    </para>
   </listitem>
   <listitem>
    <para>
     kubelet: 10255
    </para>
   </listitem>
   <listitem>
    <para>
     kube-proxy: 10256
    </para>
   </listitem>
   <listitem>
    <para>
     kube-proxy: 32000
    </para>
   </listitem>
  </itemizedlist>
  <para>
   <guimenu>Worker node role</guimenu>
  </para>
  <itemizedlist>
   <listitem>
    <para>
     ssh: 22
    </para>
   </listitem>
   <listitem>
    <para>
     etcd: 2379
    </para>
   </listitem>
   <listitem>
    <para>
     etcd: 2380
    </para>
   </listitem>
   <listitem>
    <para>
     kubelet: 4194
    </para>
   </listitem>
   <listitem>
    <para>
     flanneld: 8285 (UDP)
    </para>
   </listitem>
   <listitem>
    <para>
     kubelet: 10250
    </para>
   </listitem>
   <listitem>
    <para>
     kubelet: 10255
    </para>
   </listitem>
   <listitem>
    <para>
     kube-proxy: 10256
    </para>
   </listitem>
   <listitem>
    <para>
     kube-proxy: 32000
    </para>
   </listitem>
  </itemizedlist>
 </sect1>

 <sect1 xml:id="sec.deploy.requirements.limits">
  <title>Limitations</title>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
<!-- cwickert 2017-04-06: FIXME - check if still applies
      https://bugzilla.suse.com/show_bug.cgi?id=1029317
      jahalackova: that's still valid for 1.0.
      -->
    <para>
     &productname; &productnumber; does not support remote installations with
     <literal>Virtual Network Computing (VNC)</literal>.
    </para>
   </listitem>
   <listitem>
    <para>
     &productname; is a dedicated cluster operating system and does not
     support dual-booting with other operating systems. Ensure that all drives
     in all cluster nodes are empty and contain no other operating systems
     before beginning installation.
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>
